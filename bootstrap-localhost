#!/usr/bin/env bash

set -e
export LANG=

./bootstrap/prepare
./bootstrap/node
(cd && sudo npm -g install coffee-script)
(cd && npm install request)
npm install lib/cdb
npm install lib/cdb_changes

echo "*** Install the host agent"
sudo npm -g install applications/host

# Start application/host
MAIN_URI="$1"
shift

sudo mkdir -p /etc/ccnq3
sudo tee /etc/ccnq3/host.config <<"JSON" >/dev/null
{
  "provisioning_couchdb_uri": "${MAIN_URI}/provisioning"
}
JSON

ccnq3_host stop || echo
ccnq3_host start
